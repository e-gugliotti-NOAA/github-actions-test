name: add ss3 to path
on: 
  workflow_dispatch:

jobs:
  add-ss3-to-path:
    runs-on: ubuntu-latest

    steps:
      
      - name: install libcurl
        run: |
          sudo apt-get update
          sudo apt-get install -y libcurl4-openssl-dev

      - name: setup R  
        uses: r-lib/actions/setup-r@v2
        
      - name: Get the latest SS3 executable and put in path
        run:  |
          wget -O ss3 https://github.com/nmfs-stock-synthesis/stock-synthesis/releases/latest/download/ss_linux
          sudo chmod a+x ss3
          mv ss3 /usr/local/bin/ss3
          echo $PATH
          export PATH=/usr/local/bin/ss3:$PATH
          echo "/usr/local/bin/ss3" >> $GITHUB_PATH
          echo $PATH
          
      - name: see if R can detect ss3
        run: |
          Sys.which("ss3")
        shell: Rscript {0}
        
      - name: Get the ss last tag on unix
        id: get-latest-tag-unix
        run: |
          latest_tag=$(git ls-remote --tags https://github.com/nmfs-stock-synthesis/stock-synthesis.git | tail -1 | sed 's/.*\///')
          echo "tag=${latest_tag}" >> $GITHUB_OUTPUT
          
      - name: create tag
        uses: rickstaa/action-create-tag@v1
        with:
          tag: ${{ steps.get-latest-tag-unix.outputs.tag }}
       
